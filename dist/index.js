import "./__farm_runtime.95dcfbf6.mjs";import "./index_20f4.ef1b2a13.js";import "./index_28b7.0a6d88f5.js";import "./index_6899.bb8a5401.js";import "./index_7ec5.86f6c15a.js";import "./index_83e4.cbc365cf.js";import "./index_a702.31f70bfd.js";import "./index_af7a.bd008c89.js";import "./index_bb0a.7a00233b.js";import "./index_c3d8.37c7bca9.js";import "./index_d684.806fa8ca.js";import "./index_d841.35b65927.js";import "./index_fda8.636e7349.js";import * as __farm_external_module_fs from "fs";import * as __farm_external_module_process from "process";(globalThis || window || global)['650c7debb79582d1916d16c65fb3085a'].__farm_module_system__.setExternalModules({"fs": __farm_external_module_fs && __farm_external_module_fs.default && !__farm_external_module_fs.__esModule ? {...__farm_external_module_fs,__esModule:true} : {...__farm_external_module_fs},"process": __farm_external_module_process && __farm_external_module_process.default && !__farm_external_module_process.__esModule ? {...__farm_external_module_process,__esModule:true} : {...__farm_external_module_process}});(function(_){for(var r in _){_[r].__farm_resource_pot__='index_172f.js';(globalThis || window || global)['650c7debb79582d1916d16c65fb3085a'].__farm_module_system__.register(r,_[r])}})({"953dfae2":function a(a,t,e,c){a._m(t),a.o(t,"run",()=>s);var i=a.w(e("29bf5eaf")),r=a.i(e("fs")),n=e("cfbad0c2");async function s(){try{let t="/home/runner/work";process.chdir("..");let e=process.cwd();a.f(r).mkdir(`${t}/dist`,async()=>{await n.cloneRepo(),await n.pnpmInstall(),await n.buildProducts(),await n.generateViteTemplate({rootDir:t,currentDir:e}),await n.uploadArtifact(t);});}catch(a){a instanceof Error&&i.setFailed(a.message);}}s();},"cfbad0c2":function e(e,t,i,a){e._m(t),e.o(t,"cloneRepo",()=>c),e.o(t,"pnpmInstall",()=>p),e.o(t,"buildProducts",()=>f),e.o(t,"generateViteTemplate",()=>d),e.o(t,"uploadArtifact",()=>u);var n=e.w(i("29bf5eaf")),l=i("6fca8cd7"),s=e.w(i("5ba0ffaf")),r=e.i(i("fs")),o=i("3ddfb96a");i("process");var c=async()=>{n.startGroup("clone repo");try{let e=await l.exec("git",["init"]);await l.exec("git",["remote","add","origin","https://github.com/Tencent/tdesign-starter-cli"]),await l.exec("git",["fetch","--depth=1","origin","develop"]),await l.exec("git",["checkout","develop"]),0!==e&&n.setFailed("clone repo failed"),n.info("clone repo success");}catch(e){e instanceof Error&&n.setFailed(e.message);}n.endGroup();},p=async()=>{n.startGroup("install pnpm");try{let e=await l.exec("npm install pnpm -g");0!==e&&n.setFailed("pnpm install failed"),n.info("install pnpm success");}catch(e){e instanceof Error&&n.setFailed(e.message);}n.endGroup();},f=async()=>{n.startGroup("build dist");try{let e=await l.exec("pnpm install"),t=await l.exec("pnpm run build");(0!==t||0!==e)&&n.setFailed("build failed"),n.info("build success");}catch(e){e instanceof Error&&n.setFailed(e.message);}n.endGroup();},d=async({rootDir:t,currentDir:i})=>{n.startGroup("generate vite template");try{await l.exec("pnpm run dev init template-vite-vue3 --description 这是一个vite构建的vue3项目 --type vue3 --template lite --buildToolType vite");let t=await s.create("template-vite-*/vite.config.*");(await t.glob()).map(async t=>{let a=t.match(/template-vite-(.*)\//);if(null===a){n.setFailed("templateName is null");return;}n.info(`templateName: ${a[0]}`);let s=e.f(r).readFileSync(t,"utf-8").replace("defineConfig({",`defineConfig({
 base: '/tdesign-starter-cli/${a[0]}',`);n.info(`newViteConfig: ${s}`),e.f(r).writeFileSync(t,s);let o=`${i}/${a[0]}`;n.info(`当前目录2: ${i}`),await l.exec("pnpm install",[],{cwd:o}),await l.exec("pnpm run build",[],{cwd:o,listeners:{stdout:async e=>{n.info(e.toString());},stderr:async e=>{n.info(e.toString());},stdline:async e=>{n.info(e.toString());},errline:async e=>{n.info(e.toString());},debug:async e=>{n.info(e.toString());}}}),n.info(`copy ${a[0]} success`);});}catch(e){e instanceof Error&&n.setFailed(e.message);}n.endGroup();},u=async e=>{n.startGroup("upload artifact");try{let t=new o.DefaultArtifactClient;n.info(`artifactFilePath: ${e}`);let i=await s.create(`${e}/dist/**`,{followSymbolicLinks:!1});n.info(`createFilePath: ${i}`);let a=await i.glob();n.info(`filesGlob: ${a}`);let{id:l,size:r}=await t.uploadArtifact("github-pages",a,e);if(!l||!r)throw Error("Artifact size is undefined");return n.info(`upload artifact success, id: ${l}, size: ${r}`),{id:l,size:r};}catch(e){throw e instanceof Error&&n.setFailed(e.message),e;}};},});(globalThis || window || global)['650c7debb79582d1916d16c65fb3085a'].__farm_module_system__.setInitialLoadedResources(['index_20f4.ef1b2a13.js','index_28b7.0a6d88f5.js','index_6899.bb8a5401.js','index_7ec5.86f6c15a.js','index_83e4.cbc365cf.js','index_a702.31f70bfd.js','index_af7a.bd008c89.js','index_bb0a.7a00233b.js','index_c3d8.37c7bca9.js','index_d684.806fa8ca.js','index_d841.35b65927.js','index_fda8.636e7349.js']);(globalThis || window || global)['650c7debb79582d1916d16c65fb3085a'].__farm_module_system__.setDynamicModuleResourcesMap({  });var farmModuleSystem = (globalThis || window || global)['650c7debb79582d1916d16c65fb3085a'].__farm_module_system__;farmModuleSystem.bootstrap();var entry = farmModuleSystem.require("953dfae2");var run=entry.run;export { run };
//# sourceMappingURL=index.js.map